@page "/"
@using AvitalERP.Data
@using Microsoft.EntityFrameworkCore
@inject AppDbContext Db

@attribute [Microsoft.AspNetCore.Authorization.Authorize]

<PageTitle>Avital ERP - Dashboard</PageTitle>

<h3>📊 Dashboard</h3>

<div class="row g-3">
    <div class="col-md-3">
        <div class="card p-3">
            <div class="fw-bold">Clientes</div>
            <div class="fs-3">@Clientes</div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3">
            <div class="fw-bold">Proveedores</div>
            <div class="fs-3">@Proveedores</div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3">
            <div class="fw-bold">Ambos</div>
            <div class="fs-3">@Ambos</div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3">
            <div class="fw-bold">Mis tareas</div>
            <div class="text-muted">(pendiente módulo)</div>
        </div>
    </div>
</div>

<hr />

<div class="mt-3">
    <a class="btn btn-outline-primary" href="/clientes">Ir a Clientes/Proveedores</a>
    <a class="btn btn-outline-secondary ms-2" href="/reportes">Ir a Reportes</a>
</div>

@code {
    private int Clientes;
    private int Proveedores;
    private int Ambos;

    protected override async Task OnInitializedAsync()
    {
        Clientes = await Db.Clientes.CountAsync(c => c.EsCliente && !c.EsProveedor);
        Proveedores = await Db.Clientes.CountAsync(c => c.EsProveedor && !c.EsCliente);
        Ambos = await Db.Clientes.CountAsync(c => c.EsCliente && c.EsProveedor);
    }
}
